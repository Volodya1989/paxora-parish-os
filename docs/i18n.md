# i18n configuration and locale rollout

## Active locales
- Active locales are defined in `lib/i18n/config.ts` via `locales` (currently `en`, `uk`).
- `localeCatalog` is the staged catalog for future locales (includes `es` but not active).

## Persistence behavior
- Locale is URL-prefixed (`/[locale]/...`) and routed by `lib/i18n/localeMiddleware.ts`.
- Middleware sets `NEXT_LOCALE` cookie whenever a valid locale prefix is present.
- Client provider sync (`components/i18n/LocalePersistence.tsx`) writes:
  - `NEXT_LOCALE` cookie
  - `localStorage.paxora_locale`
- Result: locale persists across route navigation and full reload.

## Fallback behavior (explicit)
1. **Unsupported locale in URL prefix** (example: `/es/...` while `es` is not active): middleware rewrites to `/404`.
2. **No locale prefix**: middleware redirects to `/{resolvedLocale}` where resolvedLocale priority is:
   1) `NEXT_LOCALE` cookie
   2) `Accept-Language` (supported locales only)
   3) `defaultLocale` (`en`)
3. **Missing translation key in active locale**: translator falls back to English messages, and if missing there too, returns the key string.

## Controlled Spanish activation (later)
When Spanish is ready, enable in one pass:
1. Add `"es"` to `locales` in `lib/i18n/config.ts`.
2. Register `es` messages in `lib/i18n/messages.ts`.
3. Add `es` option to language switchers (`components/navigation/LanguageSwitcher.tsx`, `LanguageIconToggle.tsx`).
4. Complete `messages/es.json` before rollout.
5. Run tests: `npm test -- tests/integration/i18n-middleware.test.ts tests/unit/i18n-translator.test.ts`.
